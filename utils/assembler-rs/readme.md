# RV32I Assembler

ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„ RISC-V RV32I æŒ‡ä»¤é›†æ±‡ç¼–å™¨ï¼Œå¯ä»¥å°† RV32I æ±‡ç¼–ä»£ç è½¬æ¢ä¸ºæœºå™¨ç ï¼Œæ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ã€‚

## ç‰¹æ€§

- ğŸ”§ æ”¯æŒå®Œæ•´çš„ RV32I åŸºç¡€æŒ‡ä»¤é›†
- ğŸ“ æ”¯æŒæ ‡ç­¾å’Œè·³è½¬æŒ‡ä»¤
- ğŸ¯ æ”¯æŒå¤šç§è¾“å‡ºæ ¼å¼ï¼ˆHEX/COEï¼‰
- ğŸš€ å¿«é€Ÿã€å‡†ç¡®çš„æ±‡ç¼–è½¬æ¢
- ğŸ›¡ï¸ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œè¯Šæ–­ä¿¡æ¯
- ğŸ“Š å½©è‰²æ—¥å¿—è¾“å‡º

## æ”¯æŒçš„æŒ‡ä»¤

### åŸºç¡€æŒ‡ä»¤é›†

- **U ç±»å‹**: `lui`, `auipc`
- **J ç±»å‹**: `jal`
- **B ç±»å‹**: `beq`, `bne`, `blt`, `bge`, `bltu`, `bgeu`
- **S ç±»å‹**: `sb`, `sh`, `sw`
- **R ç±»å‹**: `add`, `sub`, `sll`, `slt`, `sltu`, `xor`, `srl`, `sra`, `or`, `and`
- **I ç±»å‹**:
  - è®¡ç®—: `addi`, `slti`, `sltiu`, `xori`, `ori`, `andi`, `slli`, `srli`, `srai`
  - åŠ è½½: `lb`, `lh`, `lw`, `lbu`, `lhu`
  - è·³è½¬: `jalr`
  - å±éšœ: `fence`, `fence.i`

### æ‰©å±•æŒ‡ä»¤ï¼ˆä¼ªæŒ‡ä»¤ï¼‰

- `ret` - è¿”å›æŒ‡ä»¤ (jalr ra, 0)
- `jr` - è·³è½¬åˆ°å¯„å­˜å™¨ (jalr x0, 0(target))
- `nop` - æ— æ“ä½œ (addi x0, x0, 0)
- `call` - è°ƒç”¨æŒ‡ä»¤ (jal ra, target)

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# å°†æ±‡ç¼–æ–‡ä»¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ ¼å¼
asm-rs input.s

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
asm-rs input.s -o output.hex

# æŒ‡å®šè¾“å‡ºæ ¼å¼
asm-rs input.s -f coe  # Xilinx COE æ ¼å¼
asm-rs input.s -f mem  # å†…å­˜åå…­è¿›åˆ¶æ ¼å¼
```

### å‘½ä»¤è¡Œé€‰é¡¹

```text
Usage: asm-rs [OPTIONS] <INPUT_FILE>

Arguments:
  <INPUT_FILE>  è¾“å…¥æ±‡ç¼–æ–‡ä»¶

Options:
  -o, --output <OUTPUT_FILE>    è¾“å‡ºæ–‡ä»¶å
  -f, --format <OUTPUT_FORMAT>  è¾“å‡ºæ ¼å¼ [å¯é€‰å€¼: mem, coe]
  -h, --help                    æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  -V, --version                 æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

## æ±‡ç¼–è¯­æ³•

### æ³¨é‡Š

æ”¯æŒä¸¤ç§æ³¨é‡Šæ ¼å¼ï¼š

```assembly
// è¿™æ˜¯å•è¡Œæ³¨é‡Š
# è¿™ä¹Ÿæ˜¯å•è¡Œæ³¨é‡Š
```

### æ ‡ç­¾

```assembly
main:           # å®šä¹‰æ ‡ç­¾
    addi x1, x0, 10
    jal main    # è·³è½¬åˆ°æ ‡ç­¾
```

### å¯„å­˜å™¨è¡¨ç¤º

æ”¯æŒæ•°å­—è¡¨ç¤ºå’Œ ABI åç§°ï¼š

```assembly
addi x1, x0, 5      # æ•°å­—è¡¨ç¤º
addi ra, zero, 5    # ABI åç§°
```

### ç«‹å³æ•°

æ”¯æŒåè¿›åˆ¶å’Œåå…­è¿›åˆ¶ï¼š

```assembly
addi x1, x0, 100    # åè¿›åˆ¶
addi x1, x0, 0x64   # åå…­è¿›åˆ¶
```

## ç¤ºä¾‹ç¨‹åº

### Hello World ç¤ºä¾‹

```assembly
_main:
    addi a0, zero, 0
    addi a1, zero, 0x48     # 'H'
    call print_char
    addi a1, zero, 0x65     # 'e'
    call print_char
    # ... æ›´å¤šå­—ç¬¦
    call _exit

print_char:
    sb a1, 0(a0)
    ret

_exit:
    nop
```

## è¾“å‡ºæ ¼å¼

### MEM æ ¼å¼ (.hex)

æ ‡å‡†çš„åå…­è¿›åˆ¶å†…å­˜æ ¼å¼ï¼š

```text
// From File: input.s
00000513
04800593
060000EF
// End of File: input.s
```

### COE æ ¼å¼ (.coe)

Xilinx å†…å­˜åˆå§‹åŒ–æ ¼å¼ï¼š

```text
memory_initialization_radix = 16;
memory_initialization_vector =
00000513,
04800593,
060000EF;
```

## é”™è¯¯å¤„ç†

æ±‡ç¼–å™¨æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼š

- ğŸ”´ **è¯­æ³•é”™è¯¯**: æ— æ•ˆçš„æŒ‡ä»¤æ ¼å¼æˆ–æ“ä½œæ•°
- ğŸŸ¡ **æ ‡ç­¾é”™è¯¯**: é‡å¤å®šä¹‰æˆ–æœªå®šä¹‰çš„æ ‡ç­¾
- ğŸŸ  **å¯„å­˜å™¨é”™è¯¯**: æ— æ•ˆçš„å¯„å­˜å™¨åç§°
- ğŸ”µ **ç«‹å³æ•°é”™è¯¯**: ç«‹å³æ•°è¶…å‡ºèŒƒå›´

## å¼€å‘

### è¿è¡Œæµ‹è¯•

```bash
cargo test
```

### æ ¼å¼åŒ–ä»£ç 

```bash
cargo fmt
```

### æ£€æŸ¥ä»£ç 

```bash
cargo clippy
```

## é¡¹ç›®ç»“æ„

```text
src/
â”œâ”€â”€ main.rs                 # ä¸»å…¥å£
â”œâ”€â”€ instruction/            # æŒ‡ä»¤å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ assembly/          # æ±‡ç¼–è§£æ
â”‚   â””â”€â”€ rv32i_instr/       # RV32I æŒ‡ä»¤å®šä¹‰
â”œâ”€â”€ logs.rs                # æ—¥å¿—è¾“å‡º
â”œâ”€â”€ options.rs             # å‘½ä»¤è¡Œå‚æ•°
â””â”€â”€ output_format.rs       # è¾“å‡ºæ ¼å¼å¤„ç†
data/                      # ç¤ºä¾‹æ±‡ç¼–æ–‡ä»¶
```
